aws configure
aws elbv2 describe-load-balancers --query 'LoadBalancers[*].[LoadBalancerName]' --output text | while read LB_NAME; do echo "Load Balancer: $LB_NAME"; aws elbv2 describe-target-groups --load-balancer-arn $(aws elbv2 describe-load-balancers --names $LB_NAME --query 'LoadBalancers[*].[LoadBalancerArn]' --output text) --query 'TargetGroups[*].[TargetGroupName]' --output text | while read TG_NAME; do echo "Target Group: $TG_NAME"; aws elbv2 describe-target-health --target-group-arn $(aws elbv2 describe-target-groups --names $TG_NAME --query 'TargetGroups[*].[TargetGroupArn]' --output text --query 'TargetGroups[*].[TargetGroupArn]' --output text) --query 'TargetHealthDescriptions[*].[TargetHealth.State, Target.Id]' --output text; done; done > output.csv
